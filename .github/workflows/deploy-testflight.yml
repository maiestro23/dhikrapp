name: Upload to TestFlight

on:  
  workflow_dispatch  # Permet de lancer manuellement l'action depuis GitHub

jobs:
  upload:
    runs-on: macos-latest  # Utilisation dâ€™un Mac gratuit sur GitHub Actions
    steps:
      - name: ðŸ“¥ Cloner le dÃ©pÃ´t
        uses: actions/checkout@v3

      - name: ðŸ”§ Installer Fastlane
        run: gem install fastlane  # Fastlane est un outil pour lâ€™App Store

      - name: ðŸš€ Envoyer le build sur TestFlight
        env:
          APP_STORE_CONNECT_API_KEY: ${{ secrets.APP_STORE_CONNECT_API_KEY }}
          APPLE_ID: ${{ secrets.APPLE_ID }}
          APPLE_TEAM_ID: ${{ secrets.APPLE_TEAM_ID }}
          BUNDLE_ID: ${{ secrets.BUNDLE_ID }}
          APP_SPECIFIC_PASSWORD: ${{ secrets.APP_SPECIFIC_PASSWORD }}
        run: |
          fastlane deliver --ipa "chemin-vers-ton-fichier.ipa" \
            --username "$APPLE_ID" \
            --app_identifier "$BUNDLE_ID" \
            --team_id "$APPLE_TEAM_ID" \
            --skip_metadata \
            --skip_screenshots \
            --automatic_release
